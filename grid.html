<!DOCTYPE html>
<html>
<head>
<style>
.grid-container {
  display: grid;
  grid-template-columns: auto auto auto auto;
  background-color: #2196F3;
  padding: 10px;
  width: 1000px;
}
.grid-item {
  background-color: rgba(50,50,0, 0.8);
  border: 1px solid rgba(0, 0, 0, 0.8);
  font-size: 30px;
  text-align: center;
}

img {
width: 50%;
}
    .trap {
        transition: transform 0.5s;
    }
</style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

</head>
<body onload="generateBoard()">
<div class="grid-container">
  <div id="00" class="grid-item" onclick="move(this.id.toString())"></div>
  <div id="01" class="grid-item" onclick="move(this.id.toString())"></div>
  <div id="02" class="grid-item" onclick="move(this.id.toString())"></div>  
  <div id="03" class="grid-item" onclick="move(this.id.toString())"></div>
  <div id="10" class="grid-item" onclick="move(this.id.toString())"></div>
  <div id="11" class="grid-item" onclick="move(this.id.toString())"></div>  
  <div id="12" class="grid-item" onclick="move(this.id.toString())"></div>
  <div id="13" class="grid-item" onclick="move(this.id.toString())"></div>
  <div id="20" class="grid-item" onclick="move(this.id.toString())"></div>
    <div id="21" class="grid-item" onclick="move(this.id.toString())"></div>
  <div id="22" class="grid-item" onclick="move(this.id.toString())"></div>  
  <div id="23" class="grid-item" onclick="move(this.id.toString())"></div>
  <div id="30" class="grid-item" onclick="move(this.id.toString())"></div>
  <div id="31" class="grid-item" onclick="move(this.id.toString())"></div> 
    <div id="32" class="grid-item" onclick="move(this.id.toString())"></div>
  <div id="33" class="grid-item" onclick="move(this.id.toString())"></div> 
</div>
    <p id="status"></p>
    <p id="one"></p>
    <p id="two"></p>
<script>
    
    // NEXT: DAMAGE FROM PLAYER TO PLAYER, POISONED ENTITIES
    
    var playerOnePos = "01";
    var playerTwoPos = "32";
    var playerOneTurn = true;
    var roundMoves = 2;
    var player1 = 0;
    var player2 = 0;
    var cards = [[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];
    
    var png = "-1.png.png";
    
    // Boundaries
    const YBOUND = 3;
    const XBOUND = 3;
    
    // Game Modes
    const DEATHMATCH = 0;
    const GOLD_RUSH = 1;
    const KILLS = 2;
    
    // Directions
    const NORTH = 0;
    const EAST = 1;
    const SOUTH = 2;
    const WEST = 3;
    
    // Types of Cards
    const TRAP = 0;
    const WEAPON = 1;
    const CURRENCY = 2;
    const ENEMY = 3;
    const EXPLOSIVE = 4;
    const CHEST = 5;
    const VIAL = 6;
    const CHARACTER = 7;
    
    // For Card Generation
    const SPAWNABLE_CARDS = 7;
    
    // Types of Player Characters
    const KNIGHT = 0;
    const MAGE = 1;
    const VIKING = 2;
    const ROGUE = 3;
    const VAMPIRE = 5;
    const MRCACTUS = 6;
    const THEIF = 7;
    const BLACKSMITH = 8;
    const ALCHEMIST = 9;
    const GRENADIER = 10;
    
    // Types of Perks
    const HEALTH = 0;
    const DAMAGE = 1;
    const WEAPON_BUFF = 2;
    const FAST_RECHARGE = 3;
    const POTION_EXPLOSION = 4;
    const GIVE_SWORD = 5;
    const GIVE_WAND = 6;
    const TELEPORT = 7;
    const GIVE_GOLD = 8;
    const FIRE_SHIELD = 9;
    const EXPLOSION_SHIELD = 10;
    
    // Types of Weapons
    const SWORD = 0;
    const GOLD_SWORD = 1;
    const WHITE_SWORD = 2;
    const VAMPIRE_SWORD = 3;
    const POISON_WAND = 4;
    const FIRE_WAND = 5;
    const ICE_WAND = 6;
    const MACE = 8;
    const POISON_SWORD = 7;
    const SHEILD = 10;
    const NOTHING = 11;
    
    // For Weapon Generation
    const SPAWNABLE_WEAPONS = 9;
    
    // Types of ENEMIES
    const ZOMBIE = 0;
    const SKELETON = 1;
    const ICE_FIEND = 2;
    const FIRE_FIEND = 3;
    const JELLYFISH = 4;
    const FLY = 5;
    const BOAR = 6;
    const TREE = 7;
    const STUMP = 8;
    const BAT = 9;
    const BAT_WITH_POTION = 10;
    const ACID_MONSTER = 11;
    const CTHULHU = 12;
    const CRAB = 13;
    const BAT_WITH_BOMB = 14;
    const CACTUS = 15;
    const MUSHROOM = 16;
    const HATLESS_MUSHROOM = 17;
    const MONSTER = 18;
    const POISONED_ZOMBIE = 19;
    
    // For Enemy Generation
    const SPAWNABLE_ENEMIES = 20;
    
    // Types of Abilities
    const FIRE_ABSORB = 0;
    const GREEN_POISON_IMMUNITY = 1;
    const PURPLE_POISON_IMMUNITY = 2;
    const EXPLOSION_IMMUNITY = 3;
    const DOUBLE_TOP_DAMAGE = 4;
    const MULTIPLE_WEAPONS = 5;
    const ATTACK_HEAL = 6;
    const SPIKE_IMMUNITY = 7;
    const REMOTE_CHEST = 8;
    const REMOTE_MINE = 9;
    const MULTIPLE_DAMAGE = 10;
    
    // Types of Traps
    const ONE_SPIKE = 0;
    const TWO_SPIKES = 1;
    const THREE_SPIKES = 2;
    const FLOOR_SPIKES = 3;
    const ONE_FIRE = 4;
    const TWO_FIRES = 5;
    const THREE_FIRES = 6;
    const TWO_SPIKES_ACR = 7;
    const TWO_FIRES_ACR = 8;
    
    // For Trap Generation
    const SPAWNABLE_TRAPS = 9;
    
    // Types of Currency
    const GOLD = 0;
    const SAPPHIRE = 1;
    const RUBY = 2;
    const GOLD_ORE = 3;
    const RUBY_ORE = 4;
    
    // For Currency Generation
    const SPAWNABLE_CURRENCIES = 5;
    
    // Types of Vials
    const RED_HEALTH = 0;
    const BLUE_HEALTH = 1;
    const GREEN_POISON = 2;
    const PURPLE_POISON = 3;
    
    // For Vial Generation
    const SPAWNABLE_VIALS = 4;
    
    // Types of Explosives
    const BOMB = 0;
    const POISON_BOMB = 1;
    const TNT = 2;
    const GOLDEN_BOMB = 3;
    
    // For Explosives Generation
    const SPAWNABLE_EXPLOSIVES = 4;
    
    // Types of Chests
    const GOOD_CHEST = 0;
    const BAD_CHEST = 1;
    
    // For Chest Generation
    const SPAWNABLE_CHESTS = 2;
    
    function Player(_char, _pos, _name/*, _perks*/) {
        this.name = _name;
        this.health = getHealth(_char);
        this.maxHealth = getHealth(_char);
        this.char = _char;
        this.image = getImage(CHARACTER, _char);
        this.weapons = _char == BLACKSMITH ? [new Weapon(15, SWORD), new WEAPON(0, NOTHING),new WEAPON(0, NOTHING)] : [new Weapon(15,SWORD)];
        this.abilites = getAbilities(_char);
        //this.perks = [perks[0],perks[1],perks[2]];
        this.effect = 0;
        this.gold = 0;
        this.class = CHARACTER;
        this.pos = _pos;
        this.addHealth = function(_amount) {
            if (_amount + this.health > this.maxHealth) {
                this.health = this.maxHealth;
            }
            else {
                this.health += _amount;
            }
        };
        this.dealDamage = function(_amount, _source = -1) {
            if (_amount < 0) {
                this.addHealth(-1 * _amount);
                return;
            }
            if (this.health > 2 && _source == GREEN_POISON) {
                this.effect = -1;
            }
            if (this.health - _amount < 1) {
                if (_source == PURPLE_POISON || _type == GREEN_POISON) {
                    this.health = 1;
                    this.effect = 0;
                }
                else if (_source = ENEMY) {
                    this.health = 0;
                    gameOver();
                }
            }
            else {
                this.health -= _amount;
            }
        };
        this.display = function() {
            var weaponDamage = 0;
            if (this.weapons[0] != null) weaponDamage = this.weapons[0].damage;
            return this.health + " | " + this.gold + " | " + weaponDamage;
        }
    }
    
    function Perk(_type) {
        this.type = _type;
        this.maxCount = getCount(_type);
        this.count = getCount(_type);
    }
    
    function Weapon(_damage, _type) {
        this.damage = _damage;
        this.type = _type;
        this.image = getImage(WEAPON, _type)
        this.poisoned = getPoison(WEAPON, _type);
        this.class = WEAPON;
        this.display = function() {
            return this.damage;
        }
        this.dealDamage = function(_amount) {
            if (_amount > this.damage) {
                this.damage = 0;
            }
            else {
                this.damage -= _amount;
            }   
        }
    }
    
    function Chest(_contains, _type) {
        this.contains = _contains;
        this.type = _type;
        this.image = getImage(CHEST, _type);
        this.opened = false;
        this.class = CHEST;
        this.display = function() {
            return "";
        }
        this.dealDamage = function(_amount) {
            
        }
    }
    
    function Currency(_amount, _type) {
        this.amount = _amount;
        this.type = _type;
        this.perkIncrement = getPerkIncrement(_type);
        this.hits = getHits(_type);
        this.image = getImage(CURRENCY, _type);
        this.class = CURRENCY;
        this.display = function() {
            return this.amount + " | " + this.hits;
        }
        this.nextOre = function() {
            if (this.hits != 0) {
                if (this.type == GOLD_ORE) this.image.src = "Gold Ore " + this.hits + png;
                if (this.type == RUBY_ORE) this.image.src = "Ruby Ore " + this.hits + png;
            }
        }
        this.dealDamage = function(_amount) {
            if (_amount >= this.amount) {
                this.amount = 1;
            }
            else {
                this.amount -= _amount;
            }   
        }
    }
    
    function Vial(_amount, _type) {
        this.amount = _amount;
        this.type = _type;
        this.image = getImage(VIAL, _type);
        this.effect = getEffect(_type);
        this.gold = _amount > 1 ? Math.floor(_amount / 2) : 1;
        this.class = VIAL;
        this.display = function() {
            return this.amount;
        }
        this.dealDamage = function(_amount) {
            if (_amount > this.amount) {
                this.amount = 0;
            }
            else {
                this.amount -= _amount;
            }   
        }
    }
    
    function Enemy(_health, _type) {
        this.health = _health;
        this.type = _type;
        this.image = getImage(ENEMY, _type);
        //this.item = getItem(_type);
        this.effect = getPoison(ENEMY, _type) ? -1 : 0;
        this.gold = _health > 1 ? Math.floor(_health / 2) : 1;
        this.class = ENEMY;
        this.display = function() {
            return this.health;
        }
        this.dealDamage = function(_amount) {
            if (_amount > this.health) {
                this.health = 0;
            }
            else {
                this.health -= _amount;
            }   
        }
    }
    
    function Explosive(_damage, _type, _count) {
        this.damage = _damage;
        this.type = _type;
        this.image = getImage(EXPLOSIVE, _type);
        this.count = _count;
        //this.range = getRange(EXPLOSIVE, _type);
        this.poisoned = getPoison(EXPLOSIVE, _type);
        this.class = EXPLOSIVE;
        this.display = function() {
            return this.damage + " | " + this.count;
        }
        this.explode = function(pos) {
            var x = parseInt(pos[1]);
            var y = parseInt(pos[0]);
            if (this.type == TNT) {
                for (var i = 0; i < XBOUND; i++) {
                    if (i != x) cards[y][i].dealDamage(this.damage);
                }
            }
            else if (this.type == BOMB || this.type == POISON_BOMB) {
                if (x > 0) {
                    cards[y][x-1].dealDamage(this.damage);
                    if (this.poisoned && (cards[y][x-1].class == CHARACTER || cards[y][x-1].class == ENEMY)) cards[y][x-1].effect = -1;
                }
                if (x < XBOUND) {
                    cards[y][x+1].dealDamage(this.damage);
                    if (this.poisoned && (cards[y][x+1].class == CHARACTER || cards[y][x+1].class == ENEMY)) cards[y][x+1].effect = -1;
                }
                if (y > 0) {
                    cards[y-1][x].dealDamage(this.damage);
                    if (this.poisoned && (cards[y-1][x].class == CHARACTER || cards[y-1][x].class == ENEMY)) cards[y-1][x].effect = -1;
                }
                if (y < YBOUND) {
                    cards[y+1][x].dealDamage(this.damage);
                    if (this.poisoned && (cards[y+1][x].class == CHARACTER || cards[y+1][x].class == ENEMY)) cards[y+1][x].effect = -1;
                }
            }
            else {
                if (x > 0) {
                    cards[y][x-1].dealDamage(-1 * this.damage);
                }
                if (x < XBOUND) {
                    cards[y][x+1].dealDamage(-1 * this.damage);
                }
                if (y > 0) {
                    cards[y-1][x].dealDamage(-1 * this.damage);
                }
                if (y < YBOUND) {
                    cards[y+1][x].dealDamage(-1 * this.damage);
                }
            }
            cards[y][x] = new Currency(1, GOLD);
        }
        this.countDown = function(pos) {
            this.count--;
            if (this.count == 0) {
                this.explode(pos);
            }
            else {
                if (this.type == BOMB) this.image.src = "Bomb " + this.count + png;
                if (this.type == POISON_BOMB) this.image.src = "Poison Bomb " + this.count + png;
                if (this.type == TNT) this.image.src = "TNT " + this.count + png;
                //if (this.type == GOLDEN_BOMB) this.image.src = "Gold Bomb " + this.count + png;
            }
        }
        this.dealDamage = function(_amount) {
            if (_amount > this.damage) this.damage = 1;
            else this.damage -= _amount;
        }
    }
    
    function Trap(_damage, _type) {
        this.damage = _damage;
        this.type = _type;
        this.image = getImage(TRAP, _type);
        this.poisoned = getPoison(TRAP, _type);
        //this.range = getRange(TRAP, _type);
        this.active = true;
        this.direction = randomNum(0,4);
        this.class = TRAP;
        this.turns = this.direction * 90;
        if (_type != FLOOR_SPIKES) {
            this.image.style.transform = "rotate(" + this.turns + "deg)";
            this.image.className = "trap";
        }
        this.display = function() {
            return this.damage;
        }
        this.dealDamage = function(_amount) {
            if (_amount > this.damage) {
                this.damage = 0;
            }
            else {
                this.damage -= _amount;
            }   
        }
        this.rotate = function() {
            if (this.type != FLOOR_SPIKES) {
                this.direction++;
                if (this.direction > WEST) {
                    this.direction = NORTH;
                }
                this.turns += 90;
                this.image.style.transform = "rotate(" + this.turns + "deg)";
            }
            else {
                this.active = !this.active;
            }
        }
        this.getDirections = function() {
            var directions = [];
            if (this.type == ONE_SPIKE || this.type == ONE_FIRE) directions = [this.direction];
            else if (this.type == TWO_SPIKES_ACR || this.type == TWO_FIRES_ACR) {
                if (this.direction == NORTH || this.direction == SOUTH) directions = [NORTH, SOUTH];
                if (this.direction == WEST || this.direction == EAST) directions = [EAST, WEST];
            }
            else if (this.type == TWO_SPIKES || this.type == TWO_FIRES) {
                if (this.direction == NORTH) directions = [NORTH, EAST];
                else if (this.direction == EAST) directions = [EAST, SOUTH];
                else if (this.direction == SOUTH) directions = [WEST, SOUTH];
                else if (this.direction == WEST) directions = [WEST, NORTH];
            }
            else if (this.type == THREE_SPIKES || this.type == THREE_FIRES) {
                if (this.direction == NORTH) directions = [NORTH, EAST, SOUTH];
                else if (this.direction == EAST) directions = [EAST, SOUTH, WEST];
                else if (this.direction == SOUTH) directions = [WEST, SOUTH, NORTH];
                else if (this.direction == WEST) directions = [WEST, NORTH, EAST];
            }
            return directions;
        }
        this.fire = function(pos) {
            var y = parseInt(pos[0]);
            var x = parseInt(pos[1]);
            var directions = this.getDirections();
            for (var d = 0; d < directions.length; d++) {
                if (directions[d] == NORTH && y > 0) cards[y-1][x].dealDamage(this.damage);
                else if (directions[d] == SOUTH && y < YBOUND) cards[y+1][x].dealDamage(this.damage);
                else if (directions[d] == EAST && x < XBOUND) cards[y][x+1].dealDamage(this.damage);
                else if (directions[d] == WEST && x > 0) cards[y][x-1].dealDamage(this.damage);
            }
        }
        this.trapped = function(_dir) {
            var directions = this.getDirections();
            return directions.includes(reverseDir(_dir));
        }
    }
    
    function Empty() {
        this.image = document.createElement("img");
    }
    
    function randomNum(_min, _max) {
        return Math.floor(Math.random() * (_max - _min)) + _min;
    }
    
    function generateWeapon() {
        var weaponType = randomNum(0, SPAWNABLE_WEAPONS); 
        var damage = randomNum(3, 14);
        var poison = weaponType == POISON_WAND || weaponType == POISON_SWORD;
        return new Weapon(damage, weaponType, poison);
    }
    
    function generateEnemy() {
        var enemyType = randomNum(0, SPAWNABLE_ENEMIES);
        var health = randomNum(2, 23);
        return new Enemy(health, enemyType);
    }
    
    function generateTrap() {
        var trapType = randomNum(0, SPAWNABLE_TRAPS);
        var damage = randomNum(1, 15);
        return new Trap(damage, trapType);
    }
    
    function generateCurrency() {
        var currencyType = randomNum(0, SPAWNABLE_CURRENCIES);
        var max = currencyType == RUBY_ORE || currencyType == GOLD_ORE ? 8 : 15
        var amount = randomNum(1, max);
        return new Currency(amount, currencyType);
    }
    
    function generateVial(type = 0) {
        var vialType = randomNum(0, SPAWNABLE_VIALS);
        if (type == 1) vialType = randomNum(0, 2);
        if (type == 2) vialType = randomNum(2,4);
        var amount = vialType != PURPLE_POISON ? randomNum(1, 13) : 1;
        return new Vial(amount, vialType);
    }
    
    function generateExplosive(onlyBad = 0) {
        var explosiveType = randomNum(0, SPAWNABLE_EXPLOSIVES - onlyBad);
        var damage = randomNum(1, 12);
        return new Explosive(damage, explosiveType, 3);
    }
    
    function generateChest() {
        var chestType = randomNum(0, SPAWNABLE_CHESTS);
        var contents = getChestContents(chestType);
        return new Chest(contents, chestType);
    }
    
    function getHits(_type) {
        if (_type == RUBY_ORE || _type == GOLD_ORE) return 4;
        return 1;
    }
    
    function getChestContents(_type) {
        if (_type == GOOD_CHEST) return generateGoodContents();
        return generateBadContents();
    }
    
    function getPoison(_class, _type) {
        return (_class == WEAPON && (_type == POISON_SWORD || _type == POISON_WAND)) || (_class == EXPLOSIVE && _type == POISON_BOMB) || (_class == ENEMY && _type == POISONED_ZOMBIE);
    }
    
    function getEffect(_type) {
        if (_type == RED_HEALTH || _type == BLUE_HEALTH) return 1;
        return -1;
    }
    
    function generateGoodContents() {
        var rand = randomNum(0,3);
        if (rand == 2) return generateWeapon();
        if (rand == 1) return generateCurrency();
        return generateVial(1);
    }
    
    function generateBadContents() {
        var rand = randomNum(0,3);
        if (rand > 1) return generateExplosive(1);
        return generateVial(2);
    }
    
    function getPerkIncrement(_type) {
        switch (_type) {
            case GOLD:
                return 1;
                break;
            case SAPPHIRE:
                return 2;
                break;
            case RUBY:
                return 3;
                break;
        }
    }
    
    function getImage(_class, _type) {
        var img = document.createElement("img");
        img.src = getImageSrc(_class, _type);
        return img;
    }
    
    function reverseDir(_dir) {
        if (_dir == NORTH) return SOUTH;
        else if (_dir == SOUTH) return NORTH;
        else if (_dir == EAST) return WEST;
        return EAST;
    }
    
    function getImageSrc(_class, _type) {
        switch (_class) {
            case CHARACTER:
                return "Knight" + png;
                break;
            case ENEMY:
                return "Monster" + png;
                break;
            case WEAPON:
                if (_type == SWORD) return "Sword" + png;
                if (_type == GOLD_SWORD) return "Gold Sword" + png;
                if (_type == WHITE_SWORD) return "White Sword" + png;
                if (_type == POISON_SWORD) return "Poison Sword" + png;
                if (_type == VAMPIRE_SWORD) return "Vampire Sword" + png;
                if (_type == POISON_WAND) return "Poison Wand" + png;
                if (_type == FIRE_WAND) return "Fire Wand" + png;
                if (_type == ICE_WAND) return "Ice Wand" + png;
                if (_type == MACE) return "Mace" + png;
                break;
            case CURRENCY:
                switch (_type) {
                    case GOLD:
                        return "Gold" + png;;
                        break;
                    case SAPPHIRE:
                        return "Sapphire" + png;
                        break;
                    case RUBY_ORE:
                        return "Ruby Ore Full" + png;
                        break;
                    case GOLD_ORE:
                        return "Gold Ore Full" + png;
                        break;
                    case RUBY:
                        return "Ruby" + png;
                        break;
                }
                break;
            case TRAP:
                switch (_type) {
                    case FLOOR_SPIKES:
                        return "Floor Spikes Active.png";
                        break;
                    case ONE_SPIKE:
                        return "Spike Trap Single" + png;
                        break;
                    case TWO_SPIKES:
                        return "Spike Trap Double Adj" + png;
                        break;
                    case THREE_SPIKES:
                        return "Spike Trap Triple" + png;
                        break;
                    case TWO_SPIKES_ACR:
                        return "Spike Trap Double Across" + png;
                        break;
                    case TWO_FIRES_ACR:
                        return "Fire Trap Double Across" + png;
                        break;
                    case ONE_FIRE:
                        return "Fire Trap Single" + png;
                        break;
                    case THREE_FIRES:
                        return "Fire Trap Triple" + png;
                        break;
                    case TWO_FIRES:
                        return "Fire Trap Double Adj" + png;
                        break;
                }
                break;
            case EXPLOSIVE:
                if (_type == BOMB) return "Bomb 3" + png;
                if (_type == TNT) return "TNT 3" + png;
                if (_type == POISON_BOMB) return "Poison Bomb 3" + png;
                if (_type == GOLDEN_BOMB) return "Gold Bomb" + png;
                break;
            case VIAL:
                switch (_type) {
                    case BLUE_HEALTH:
                        return "Blue Vial" + png;
                        break;
                    case RED_HEALTH:
                        return "Red Vial" + png;
                        break;
                    case GREEN_POISON:
                        return "Green Vial" + png;
                        break;
                    case PURPLE_POISON:
                        return "Purple Vial" + png;
                        break;
                }
                break;
            case CHEST:
                switch (_type) {
                    case GOOD_CHEST:
                        return "Good Chest" + png;
                        break;
                    case BAD_CHEST:
                        return "Bad Chest" + png;
                        break;
                }
                break;
        }
    }
    
    function getAbilities(_char) {
        switch (_char) {
            case MAGE:
                return [FIRE_ABSORB];
                break;
            case VIKING:
                return [EXPLOSION_IMMUNITY, MULTIPLE_DAMAGE];
                break;
            case ROGUE:
                return [GREEN_POISON_IMMUNITY, DOUBLE_TOP_DAMAGE];
                break;
            case VAMPIRE:
                return [ATTACK_HEAL];
                break;
            case MRCACTUS:
                return [SPIKE_IMMUNITY];
                break;
            case THEIF:
                return [REMOTE_CHEST, REMOTE_MINE];
                break;
            case BLACKSMITH:
                return [MULTIPLE_WEAPONS];
                break;
            case ALCHEMIST:
                return [GREEN_POISON_IMMUNITY, PURPLE_POISON_IMMUNITY];
                break;
            case GRENADIER:
                return [EXPLOSION_IMMUNITY];
                break;
        }
    }
    
    function getHealth(_char) {
        switch (_char) {
            case KNIGHT:
                return 53;
                break;
            case ROGUE:
                return 45;
                break;
            case BLACKSMITH:
                return 48;
                break;
            case GRENADIER:
                return 51;
                break;
            default:
                return 50;
                break;
        }
    }
    
    function getCount(_perk) {
        switch (_perk) {
            case HEALTH:
                return 8;
                break;
            case DAMAGE:
                return 10;
                break;
            case WEAPON_BUFF:
                return 11;
                break;
            case POTION_EXPLOSION:
                return 12;
                break;
            case SWORD:
                return 9;
                break;
            case WAND:
                return 9;
                break;
            case TELEPORT:
                return 16;
                break;
            case GOLD:
                return 15;
                break;
            case FIRE_SHIELD:
                return -1;
                break;
            case EXPLOSION_SHIELD:
                return -1;
                break;
        }
    }
    
    function generateItem() {
        var rand = randomNum(0, SPAWNABLE_CARDS);
        switch (rand) {
            case ENEMY:
                return generateEnemy();
                break;
            case WEAPON:
                return generateWeapon();
                break;
            case CURRENCY:
                return generateCurrency();
                break;
            case VIAL:
                return generateVial();
                break;
            case EXPLOSIVE:
                return generateExplosive();
                break;
            case CHEST:
                return generateChest();
                break;
            case TRAP:
                return generateTrap();
                break;
        }
    }
    
    function generateBoard() {
        for (var y = 0; y < 4; y++) {
            for (var x = 0; x < 4; x++) {
                if ((y == 0 && x == 1) || (y == 3 && x == 2)) {
                    var player = y == 0 ? "player1" : "player2";
                    var char = new Player(KNIGHT, y.toString() + x.toString(), player);
                    document.getElementById(char.pos).appendChild(char.image);
                    var p = document.createElement("p");
                    p.innerHTML = char.display();
                    document.getElementById(y.toString() + x.toString()).appendChild(char.weapons[0].image);
                    document.getElementById(y.toString() + x.toString()).appendChild(p);
                    cards[y][x] = char;
                    if (y == 0) player1 = char;
                    else player2 = char;
                }
                else {
                    var item = generateItem();
                    document.getElementById(y.toString() + x.toString()).appendChild(item.image);
                    var p = document.createElement("p");
                    p.innerHTML = item.display();
                    document.getElementById(y.toString() + x.toString()).appendChild(p);
                    cards[y][x] = item;
                }
            }
        }
    }
    
    function move(newPos) {
        var currPos = playerOneTurn ? player1.pos : player2.pos;
        if (!adjacent(currPos, newPos)) {
            return;
        }
        interact(newPos);
        roundMoves--;
        if (roundMoves < 1) {
            playerOneTurn = !playerOneTurn;
            roundMoves = 2;
        }
        document.getElementById("status").innerHTML = (playerOneTurn ? "Player 1" : "Player 2") + " | " + roundMoves;
        endMove();
        redrawCards();
    }
    
    function redrawCards() {
        for (var y = 0; y < 4; y++) {
            for (var x = 0; x < 4; x++) {
                document.getElementById(y.toString() + x.toString()).innerHTML = "";
                var imgTag = cards[y][x].image;
                var p = document.createElement("p");
                p.innerHTML = cards[y][x].display();
                document.getElementById(y.toString() + x.toString()).appendChild(imgTag);
                if (cards[y][x].class == CHARACTER) {
                    if (cards[y][x].weapons[0] != null) {
                        document.getElementById(y.toString() + x.toString()).appendChild(cards[y][x].weapons[0].image);
                    }
                    else {
                        var empty = document.createElement("img");
                        empty.src = "Empty.png";
                        document.getElementById(y.toString() + x.toString()).appendChild(empty);
                    }
                }
                document.getElementById(y.toString() + x.toString()).appendChild(p);
            }
        }
    }
    
    function interact(_pos) {
        var y = parseInt(_pos[0]);
        var x = parseInt(_pos[1]);
        var player = playerOneTurn ? player1 : player2;
        var currPos = player.pos;
        var currPosInt = [parseInt(currPos[0]), parseInt(currPos[1])];
        var card = cards[y][x];
        var class_ = card.class;
        var dir = getDirection(currPos, _pos);
        switch (class_) {
            case WEAPON:
                var emptySlotFound = false;
                for (var w = 0; w < player.weapons.length; w++) {
                    if ((player.weapons[w] == null || player.weapons[w].damage < card.damage) && !emptySlotFound) {
                        player.weapons[w] = card;
                        emptySlotFound = true;
                    }
                }
                if (!emptySlotFound) {
                    var addGold = Math.floor(card.damage / 2);
                    if (addGold < 1) addGold = 1;
                    player.gold += addGold;
                }
                cards[y][x] = player;
                player.pos = _pos;
                slide(currPosInt[0],currPosInt[1], dir);
                break;
            case CURRENCY:
                player.gold += card.amount;
                card.hits--;
                if (card.type == GOLD_ORE || card.type == RUBY_ORE) card.nextOre();
                if (card.hits < 1) {
                    cards[y][x] = player;
                    slide(currPosInt[0],currPosInt[1], dir);
                }
                break;
            case CHEST:
                card.opened = true;
                cards[y][x] = card.contains;
                break;
            case VIAL:
                var amount = card.type == PURPLE_POISON ? (Math.floor(0.25 * player.health)) : card.amount;
                var source = card.type == PURPLE_POISON ? PURPLE_POISON : GREEN_POISON;
                if (card.effect == 1) player.addHealth(amount);
                else player.dealDamage(amount, source);
                cards[y][x] = player;
                slide(currPosInt[0],currPosInt[1], dir);
                break;
            case ENEMY:
                var enemyHealth = card.health;
                var weapon = player.weapons[0];
                if (weapon != null && weapon.damage > 0) {
                    if (weapon.damage > enemyHealth) {
                        player.weapons[0].damage -= card.health;
                        card.dealDamage(card.health);
                        cards[y][x] = new Currency(card.gold, GOLD);
                    }
                    else {
                        card.dealDamage(weapon.damage);
                        player.weapons[0].damage -= enemyHealth;
                    }
                }
                else {
                    if (player.health > enemyHealth) {
                        player.gold += card.gold;
                        player.dealDamage(enemyHealth)
                        cards[y][x] = player;
                        slide(currPosInt[0],currPosInt[1], dir);
                    }
                    else {
                        gameOver()
                    }
                }
                break;
            case EXPLOSIVE:
                var temp = cards[y][x];
                cards[y][x] = cards[currPosInt[0]][currPosInt[1]];
                cards[currPosInt[0]][currPosInt[1]] = temp;
                break;
            case TRAP:
                if (card.type == ONE_SPIKE || card.type == TWO_SPIKES || card.type == THREE_SPIKES || card.type == TWO_SPIKES_ACR) {
                    if (card.trapped(dir)) {
                        player.dealDamage(card.damage);
                    }
                }
                else if (card.type == ONE_FIRE || card.type == TWO_FIRES || card.type == THREE_FIRES || card.type == TWO_FIRES_ACR) {
                    card.fire([y,x]);
                }
                else if (card.type == FLOOR_SPIKES) {
                    if (card.active) player.dealDamage(card.damage);
                }
                cards[y][x] = player;
                player.pos = _pos;
                slide(currPosInt[0],currPosInt[1], dir);
                break;
            case CHARACTER:
                break;
        }
        if (playerOneTurn) {
            player1 = player;
        }
        else {
            player2 = player;
        }
    }
    
    function getDirection(_start, _end) {
        if (parseInt(_start[0]) < parseInt(_end[0])) {
            return SOUTH;
        }
        if (parseInt(_start[0]) > parseInt(_end[0])) {
            return NORTH;
        }
        if (parseInt(_start[1]) > parseInt(_end[1])) {
            return WEST;
        }
        if (parseInt(_start[1]) < parseInt(_end[1])) {
            return EAST;
        }
    }
    
    function slide(moveY, moveX, dir) {
        if (moveY < 1) {
            var xcoord = moveX;
            var ycoord = moveY;
            if (dir != SOUTH) {
                if (dir == WEST) {
                    while (xcoord < XBOUND) {
                        cards[moveY][xcoord] = cards[moveY][xcoord+1];
                        xcoord++;
                    }
                }
                else {
                    while (xcoord > 0) {
                        cards[moveY][xcoord] = cards[moveY][xcoord-1];
                        xcoord--;
                    }
                }
            }
            else {
                while (xcoord > 0) {
                    cards[ycoord][xcoord] = cards[ycoord][xcoord-1];
                    xcoord--;
                }
            }
            cards[ycoord][xcoord] = generateItem();
        }
        else if (moveY > YBOUND - 1) {
            var xcoord = moveX;
            if (!(xcoord < 1 || xcoord > XBOUND - 1)) {
                if (dir == EAST) {
                    while (xcoord > 0) {
                        cards[moveY][xcoord] = cards[moveY][xcoord-1];
                        xcoord--;
                    }
                }
                else {
                    while (xcoord < XBOUND) {
                        cards[moveY][xcoord] = cards[moveY][xcoord+1];
                        xcoord++;
                    }
                }
            }
            else {
                if (dir == EAST) {
                    while (xcoord > 0) {
                        cards[moveY][xcoord] = cards[moveY][xcoord-1];
                        xcoord--;
                    }
                }
                else {
                    while (xcoord < XBOUND) {
                        cards[moveY][xcoord] = cards[moveY][xcoord+1];
                        xcoord++;
                    }   
                }
            }
            cards[moveY][xcoord] = generateItem();
        }
        else if (moveX < 1) {
            var ycoord = moveY;
            if (dir != EAST) {
                if (dir == NORTH) {
                    while (ycoord < YBOUND) {
                        cards[ycoord][moveX] = cards[ycoord+1][moveX];
                        ycoord++;
                    }
                }
                else {
                    while (ycoord > 0) {
                        cards[ycoord][moveX] = cards[ycoord-1][moveX];
                        ycoord--;
                    }
                }
            }
            cards[ycoord][moveX] = generateItem();
        }
        else if (moveX > XBOUND - 1) {
            var ycoord = moveY;
            if (dir != WEST) {
                if (dir == NORTH) {
                    while (ycoord < YBOUND) {
                        cards[ycoord][moveX] = cards[ycoord+1][moveX];
                        ycoord++;
                    }
                }
                else {
                    while (ycoord > 0) {
                        cards[ycoord][moveX] = cards[ycoord-1][moveX];
                        ycoord--;
                    }
                }
            }
            cards[ycoord][moveX] = generateItem();
        }
        else {
            var xcoord = moveX;
            var ycoord = moveY;
            if (dir == NORTH) {
                while (ycoord < YBOUND) {
                    cards[ycoord][moveX] = cards[ycoord+1][moveX];
                    ycoord++;
                }
            }
            else if (dir == SOUTH) {
                while (ycoord > 0) {
                    cards[ycoord][moveX] = cards[ycoord-1][moveX];
                    ycoord--;
                }
            }
            else if (dir == WEST) {
                while (xcoord < XBOUND) {
                    cards[moveY][xcoord] = cards[moveY][xcoord+1];
                    xcoord++;
                }
            }
            else if (dir == EAST) {
                while (xcoord > 0) {
                    cards[moveY][xcoord] = cards[moveY][xcoord-1];
                    xcoord--;
                }
            }
            cards[ycoord][xcoord] = generateItem();
        }
    }
    
    function adjacent(_posA, _posB) {
        var posA = [parseInt(_posA[0]), parseInt(_posA[1])];
        var posB = [parseInt(_posB[0]), parseInt(_posB[1])];
        if ((posA[0] == posB[0] + 1 || posA[0] == posB[0] - 1) && posA[1] == posB[1]) return true;
        if ((posA[1] == posB[1] + 1 || posA[1] == posB[1] - 1) && posA[0] == posB[0]) return true;
        return false;
    }
    
    function endMove() {
        for (var x = 0; x < XBOUND + 1; x++) {
            for (var y = 0; y < YBOUND + 1; y++) {
                var item = cards[y][x];
                var _class = item.class;
                if (_class == EXPLOSIVE) {
                    cards[y][x].countDown(y.toString() + x.toString());
                }
                else if (_class == CHARACTER) {
                    cards[y][x].pos = y.toString() + x.toString();
                    if (item.weapons[0] != null && item.weapons[0].damage < 1) {
                        cards[y][x].weapons[0] = null;
                        if (cards[y][x].type = BLACKSMITH) {
                            var openSlot = 0;
                            for (var w = 1; w < item.weapons.length; w++) {
                                if (item.weapons[w].damage > 0) {
                                    cards[y][x].weapons[openSlot] = item.weapons[w];
                                    openSlot++;
                                    cards[y][x].weapons[w] = null;
                                }
                            }
                        }
                    }
                }
                else if (_class == WEAPON) {
                    if (item.damage == 0) {
                        cards[y][x] = new Currency(item.gold, GOLD);
                    }
                }
                else if (_class == VIAL) {
                    if (item.amount == 0) {
                        cards[y][x] = new Currency(1, GOLD);
                    }
                }
                else if (_class == TRAP) {
                    cards[y][x].rotate();
                    if (item.type == FLOOR_SPIKES) {
                        var img = document.createElement("img");
                        img.src = cards[y][x].active ? "Floor Spikes Active.png" : "Floor Spikes Inactive.png";
                        cards[y][x].image = img;
                    }
                    if (item.damage == 0) {
                        cards[y][x] = new Currency(1, GOLD);
                    }
                }
                else if (_class == ENEMY) {
                    if (item.health < 1) {
                        cards[y][x] = new Currency(item.gold, GOLD);
                    }
                }
            }
        }
    }
    
</script>
</body>
</html>
